---
import {getCollection} from "astro:content"

import Layout from "../layouts/Layout.astro"
import FeaturedPost from "../components/FeaturedPost.astro"
import Category from "../components/Category.astro"

const allPosts = await getCollection("posts")
const posts = allPosts.filter(post => !post.data.featured)
const featuredPosts = allPosts.filter(post => post.data.featured)

// TODO: optimize this
const authors = await getCollection("authors")

const categories = Array.from(
    allPosts.reduce((categories, post) => {
        post.data.categories.forEach(category => categories.add(category))
        return categories
    }, new Set<string>()),
)
---

<Layout title="Rhythm Nation">
    <main class="px-24 max-sm:px-5 overflow-hidden">
        <h1 class="text-6xl text-teal-900 font-bold mb-5">
            Rhythm Nation Blog
        </h1>

        <p class="text-zinc-900 text-2xl mb-24 max-sm:mb-14">
            Join the Community and learn from Music Producers and Enthusiasts
        </p>

        {
            featuredPosts.map(post => {
                const author = authors.find(
                    author => author.slug === post.data.author,
                )

                if (!author) {
                    return null
                }

                return <FeaturedPost author={author} post={post} />
            })
        }

        <hr class="w-full border border-teal-900 mb-16 max-sm:mb-10" />

        <div class="flex gap-x-14 gap-y-3 mb-16 max-sm:flex-col">
            <span class="font-bold text-5xl text-teal-900">Recent posts</span>

            <div class="flex flex-row gap-x-4 overflow-x-auto">
                <Category category="All categories" />
                {categories.map(category => <Category category={category} />)}
            </div>
        </div>

        {
            posts.map(post => {
                return <p>{post.data.title}</p>
            })
        }
    </main>
</Layout>
